<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Калькулятор БЖУ</title>
  <style>
    body {
      background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('https://images.unsplash.com/photo-1593079831268-3381b0db4a77?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80') no-repeat center center fixed;
      background-size: cover;
      color: #fff;
      font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
    }

    #particles-js {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      z-index: 0;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(5px);
      border-radius: 12px;
      z-index: 1;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 30px;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
      margin-bottom: 30px;
    }

    .header .logo {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .header .logo img {
      width: 32px;
      height: 32px;
    }

    .header .logo .date-selector {
      font-size: 1.5rem;
      font-weight: 500;
      color: #333;
      cursor: pointer;
      position: relative;
    }

    .header .logo .date-selector:hover {
      color: #4CAF50;
    }

    .header .icons {
      display: flex;
      gap: 30px;
    }

    .header .icons .icon {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }

    .header .icons .icon img {
      width: 28px;
      height: 28px;
      opacity: 0.7;
      transition: opacity 0.2s;
    }

    .header .icons .icon span {
      font-size: 1rem;
      color: #333;
    }

    .header .icons .icon:hover img {
      opacity: 1;
    }

    .macros {
      display: flex;
      justify-content: space-between;
      padding: 20px 30px;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
      margin-bottom: 30px;
    }

    .macros div {
      text-align: center;
      flex: 1;
      position: relative;
    }

    .macros .value {
      font-size: 1.5rem;
      font-weight: 600;
      color: #333;
      margin-bottom: 5px;
    }

    .macros .label {
      font-size: 1rem;
      color: #666;
    }

    .macros .progress-circle {
      position: relative;
      width: 60px;
      height: 60px;
      margin: 0 auto 10px;
    }

    .macros .progress-circle svg {
      width: 100%;
      height: 100%;
      transform: rotate(-90deg);
    }

    .macros .progress-circle circle {
      fill: none;
      stroke-width: 6;
    }

    .macros .progress-circle .bg {
      stroke: #e0e0e0;
    }

    .macros .progress-circle .progress {
      stroke: #4CAF50;
      stroke-dasharray: 163;
      stroke-dashoffset: 163;
      transition: stroke-dashoffset 0.5s ease;
    }

    .details {
      padding-bottom: 100px;
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 30px;
    }

    .details .section {
      background: #ffffff;
      border-radius: 12px;
      padding: 25px 35px;
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
      position: relative;
      display: flex;
      flex-direction: column;
      gap: 20px;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .details .section:hover {
      transform: scale(1.02);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }

    .details .section .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .details .section h3 {
      font-size: 1.5rem;
      font-weight: 500;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 15px;
      color: #333;
    }

    .details .section h3 img {
      width: 24px;
      height: 24px;
    }

    .details .section .calories {
      font-size: 1.1rem;
      color: #666;
    }

    .details .section .food-list {
      margin-top: 20px;
    }

    .details .section .food-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 0;
      border-bottom: 1px solid #eee;
    }

    .details .section .food-item .name {
      font-size: 1.2rem;
      color: #333;
    }

    .details .section .food-item .delete-btn {
      background: #EF5350;
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.2s;
    }

    .details .section .food-item .delete-btn:hover {
      background: #d32f2f;
    }

    .details .section .add-btn {
      background: #4CAF50;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 10px 20px;
      cursor: pointer;
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: background 0.2s;
    }

    .details .section .add-btn:hover {
      background: #388E3C;
    }

    .details .section .add-btn img {
      width: 20px;
      height: 20px;
    }

    .details .section .toggle-btn {
      color: #666;
      font-size: 1.1rem;
      cursor: pointer;
      transition: color 0.2s;
    }

    .details .section .toggle-btn:hover {
      color: #333;
    }

    .details .section .tracker-content {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-top: 20px;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 10px;
      width: 100%;
    }

    .details .section .tracker-content input {
      background: #ffffff;
      border: 1px solid #ddd;
      color: #333;
      padding: 12px;
      border-radius: 6px;
      font-size: 1rem;
      width: 120px;
    }

    .details .section .tracker-content button {
      background: #4CAF50;
      color: #fff;
      border: none;
      padding: 12px 25px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: 10px;
      transition: background 0.2s;
    }

    .details .section .tracker-content button:hover {
      background: #388E3C;
    }

    .details .section .tracker-content .total-water {
      font-size: 1.2rem;
      font-weight: 600;
      color: #4CAF50;
    }

    .food-search {
      background: #ffffff;
      padding: 25px;
      border-radius: 12px;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.9);
      width: 90%;
      max-width: 900px;
      display: none;
      z-index: 1000;
      box-shadow: 0 3px 12px rgba(0, 0, 0, 0.15);
      opacity: 0;
      transition: opacity 0.3s ease, transform 0.3s ease;
    }

    .food-search.active {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }

    .food-search .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }

    .food-search .modal-header h3 {
      font-size: 1.5rem;
      margin: 0;
      color: #333;
    }

    .food-search .modal-header .close-btn {
      background: #EF5350;
      color: #fff;
      border: none;
      padding: 10px 15px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.2s;
    }

    .food-search .modal-header .close-btn:hover {
      background: #d32f2f;
    }

    .food-search .tabs {
      display: flex;
      justify-content: space-around;
      margin-bottom: 25px;
    }

    .food-search .tabs div {
      padding: 12px 20px;
      font-size: 1.1rem;
      cursor: pointer;
      color: #666;
      border-bottom: 3px solid transparent;
      transition: color 0.2s, border-bottom 0.2s;
    }

    .food-search .tabs .active {
      border-bottom: 3px solid #4CAF50;
      color: #4CAF50;
    }

    .food-search .search-bar {
      display: flex;
      align-items: center;
      background: #f5f5f5;
      border-radius: 25px;
      padding: 12px 20px;
      box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.1);
    }

    .food-search .search-bar input {
      background: transparent;
      border: none;
      color: #333;
      flex: 1;
      padding: 10px;
      font-size: 1.1rem;
    }

    .food-search .search-bar input::placeholder {
      color: #999;
    }

    .food-search .search-bar img {
      width: 24px;
      height: 24px;
      opacity: 0.7;
    }

    .food-search .results {
      margin-top: 25px;
      max-height: 450px;
      overflow-y: auto;
    }

    .food-search .results .item {
      display: flex;
      align-items: center;
      gap: 20px;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 10px;
      margin-bottom: 20px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .food-search .results .item:hover {
      background: #f0f0f0;
    }

    .food-search .results .item img {
      width: 70px;
      height: 70px;
      border-radius: 6px;
      object-fit: cover;
    }

    .food-search .results .item .info {
      flex: 1;
    }

    .food-search .results .item .info .name {
      font-size: 1.1rem;
      font-weight: 500;
      color: #333;
    }

    .food-search .results .item .info .time {
      font-size: 1rem;
      color: #666;
    }

    .weight-modal {
      background: #ffffff;
      padding: 25px;
      border-radius: 12px;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.9);
      width: 90%;
      max-width: 600px;
      display: none;
      z-index: 1001;
      box-shadow: 0 3px 12px rgba(0, 0, 0, 0.15);
      opacity: 0;
      transition: opacity 0.3s ease, transform 0.3s ease;
    }

    .weight-modal.active {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }

    .weight-modal h3 {
      font-size: 1.5rem;
      margin: 0 0 25px;
      color: #333;
    }

    .weight-modal input {
      background: #ffffff;
      border: 1px solid #ddd;
      color: #333;
      padding: 15px;
      border-radius: 6px;
      width: 100%;
      margin-bottom: 25px;
      font-size: 1.1rem;
    }

    .weight-modal button {
      background: #4CAF50;
      color: #fff;
      border: none;
      padding: 15px;
      border-radius: 6px;
      width: 100%;
      cursor: pointer;
      font-size: 1.1rem;
      transition: background 0.2s;
    }

    .weight-modal button:hover {
      background: #388E3C;
    }

    .calendar-modal {
      background: #ffffff;
      padding: 25px;
      border-radius: 12px;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.9);
      display: none;
      z-index: 1001;
      width: 90%;
      max-width: 600px;
      box-shadow: 0 3px 12px rgba(0, 0, 0, 0.15);
      opacity: 0;
      transition: opacity 0.3s ease, transform 0.3s ease;
    }

    .calendar-modal.active {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }

    .calendar-modal .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }

    .calendar-modal .modal-header h3 {
      font-size: 1.5rem;
      margin: 0;
      text-align: center;
      color: #333;
      flex: 1;
    }

    .calendar-modal .modal-header .close-btn {
      background: #EF5350;
      color: #fff;
      border: none;
      padding: 10px 15px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.2s;
    }

    .calendar-modal .modal-header .close-btn:hover {
      background: #d32f2f;
    }

    .calendar-modal .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
      text-align: center;
    }

    .calendar-modal .calendar-grid div {
      padding: 15px;
      border-radius: 6px;
      cursor: pointer;
    }

    .calendar-modal .calendar-grid .day {
      background: #f9f9f9;
      color: #333;
      transition: background 0.2s;
    }

    .calendar-modal .calendar-grid .day:hover {
      background: #e0e0e0;
    }

    .calendar-modal .calendar-grid .header {
      font-weight: 500;
      color: #666;
    }

    .goals-modal {
      background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('https://images.unsplash.com/photo-1593079831268-3381b0db4a77?ixlib=rb-4.0.3&auto=format&fit=crop&w=1350&q=80') no-repeat center center fixed;
      background-size: cover;
      padding: 40px;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: none;
      z-index: 1002;
      overflow-y: auto;
    }

    #goals-particles-js {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      z-index: 0;
    }

    .goals-modal .progress-bar {
      position: relative;
      width: 100%;
      height: 8px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 4px;
      margin-bottom: 40px;
      overflow: hidden;
    }

    .goals-modal .progress-bar .progress {
      height: 100%;
      background: #ffffff;
      border-radius: 4px;
      transition: width 0.5s ease;
    }

    .goals-modal .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }

    .goals-modal .header h2 {
      font-size: 2.2rem;
      margin: 0;
      text-align: center;
      color: #ffffff;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s ease;
      position: relative;
      z-index: 1;
    }

    .goals-modal .header h2:hover {
      transform: scale(1.05);
    }

    .goals-modal .header .close-btn {
      background: #EF5350;
      color: #fff;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1.1rem;
      transition: background 0.2s;
      z-index: 1;
    }

    .goals-modal .header .close-btn:hover {
      background: #d32f2f;
    }

    .goals-modal .step {
      margin-bottom: 50px;
      background: #ffffff;
      padding: 30px;
      border-radius: 8px;
      position: relative;
      z-index: 1;
    }

    .goals-modal .step h3 {
      font-size: 1.7rem;
      margin: 0 0 25px;
      color: #333;
      text-align: center;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      transition: color 0.3s ease;
    }

    .goals-modal .step h3:hover {
      color: #4CAF50;
    }

    .goals-modal .step select,
    .goals-modal .step input {
      background: #ffffff;
      border: 1px solid #ddd;
      color: #333;
      padding: 15px;
      border-radius: 8px;
      width: 100%;
      margin-bottom: 20px;
      font-size: 1.1rem;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }

    .goals-modal .step select:focus,
    .goals-modal .step input:focus {
      border-color: #4CAF50;
      box-shadow: 0 0 8px rgba(76, 175, 80, 0.3);
      outline: none;
    }

    .goals-modal .step .options {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .goals-modal .step .option {
      background: #ffffff;
      padding: 25px;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .goals-modal .step .option:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
      background: #f5f5f5;
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.5); }
      70% { box-shadow: 0 0 0 15px rgba(76, 175, 80, 0); }
      100% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0); }
    }

    .goals-modal .step .option.selected {
      background: #4CAF50;
      color: #fff;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
      transform: scale(1.02);
    }

    .goals-modal .step .option p {
      margin: 0;
      font-size: 1.2rem;
      font-weight: 500;
    }

    .goals-modal .step .option small {
      color: #666;
      font-size: 1rem;
    }

    .goals-modal .step .option.selected small {
      color: #e0e0e0;
    }

    .goals-modal .step .error {
      color: #EF5350;
      font-size: 1rem;
      margin-top: 10px;
      text-align: center;
      display: none;
    }

    .goals-modal .next-btn {
      background: #4CAF50;
      color: #fff;
      border: none;
      padding: 15px;
      border-radius: 8px;
      width: 100%;
      cursor: pointer;
      font-size: 1.2rem;
      margin-top: 40px;
      position: relative;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      z-index: 1;
    }

    .goals-modal .next-btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.6s ease, height 0.6s ease;
    }

    .goals-modal .next-btn:hover::before {
      width: 300px;
      height: 300px;
    }

    .goals-modal .next-btn:hover:enabled:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .goals-modal .next-btn:disabled {
      background: #cccccc;
      cursor: not-allowed;
    }

    .goals-modal .reset-btn {
      background: #EF5350;
      color: #fff;
      border: none;
      padding: 15px;
      border-radius: 8px;
      width: 100%;
      cursor: pointer;
      font-size: 1.2rem;
      margin-top: 20px;
      position: relative;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      z-index: 1;
    }

    .goals-modal .reset-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .settings-section {
      background: #ffffff;
      padding: 20px 30px;
      border-radius: 12px;
      margin: 20px 0;
      cursor: pointer;
      text-align: center;
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
      color: #4CAF50;
      font-weight: 500;
      font-size: 1.2rem;
      transition: background 0.2s;
      grid-column: span 2;
    }

    .details .summary-section {
      background: #ffffff;
      border-radius: 12px;
      padding: 25px 35px;
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      grid-column: span 2;
    }

    .details .summary-section .summary-text {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .details .summary-section h3 {
      font-size: 1.7rem;
      font-weight: 700;
      margin: 0;
      color: #333;
      text-transform: uppercase;
    }

    .details .summary-section .calories-label {
      font-size: 1.2rem;
      font-weight: 500;
      color: #333;
    }

    .details .summary-section .calories-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: #333;
    }

    .details .summary-section .percentage {
      font-size: 1.1rem;
      font-weight: 500;
      color: #666;
    }

    .details .summary-section .progress-circle {
      position: relative;
      width: 100px;
      height: 100px;
    }

    .details .summary-section .progress-circle svg {
      width: 100%;
      height: 100%;
      transform: rotate(-90deg);
    }

    .details .summary-section .progress-circle circle {
      fill: none;
      stroke-width: 10;
    }

    .details .summary-section .progress-circle .bg {
      stroke: #e0e0e0;
    }

    .details .summary-section .progress-circle .progress {
      stroke: #4CAF50;
      stroke-dasharray: 283;
      stroke-dashoffset: 283;
      transition: stroke-dashoffset 0.5s ease;
    }

    .details .summary-section .progress-circle .percentage-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 1.2rem;
      font-weight: 600;
      color: #333;
    }

    .settings-section:hover {
      background: #f9f9f9;
    }

    .tooltip {
      position: relative;
      display: inline-block;
    }

    .tooltip .tooltiptext {
      visibility: hidden;
      width: 120px;
      background-color: #333;
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 5px 0;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      margin-left: -60px;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }

    .error-message {
      background: #EF5350;
      color: #fff;
      padding: 15px;
      border-radius: 6px;
      text-align: center;
      margin-top: 10px;
      display: none;
    }
  </style>
</head>
<body>
  <div id="particles-js"></div>

  <div class="container">
    <div class="header">
      <div class="logo">
        <img src="https://cdn-icons-png.flaticon.com/512/892/892781.png" alt="Logo">
        <div class="date-selector" onclick="openCalendar()">
          <span id="currentDate">Сьогодні</span>
        </div>
      </div>
      <div class="icons">
        <div class="icon" onclick="openFoodSearch('breakfast')">
          <img src="https://cdn-icons-png.flaticon.com/512/482/482947.png" alt="Search">
          <span>Пошук їжі</span>
        </div>
        <div class="icon" onclick="openCalendar()">
          <img src="https://cdn-icons-png.flaticon.com/512/2695/2695976.png" alt="Calendar">
          <span>Вибрати дату</span>
        </div>
      </div>
    </div>

    <div class="macros">
      <div>
        <div class="progress-circle">
          <svg>
            <circle class="bg" cx="30" cy="30" r="26"></circle>
            <circle class="progress" id="fatProgress" cx="30" cy="30" r="26"></circle>
          </svg>
        </div>
        <div class="value" id="totalFat">0</div>
        <div class="label">Жири</div>
      </div>
      <div>
        <div class="progress-circle">
          <svg>
            <circle class="bg" cx="30" cy="30" r="26"></circle>
            <circle class="progress" id="carbsProgress" cx="30" cy="30" r="26"></circle>
          </svg>
        </div>
        <div class="value" id="totalCarbs">0</div>
        <div class="label">Вуглеводи</div>
      </div>
      <div>
        <div class="progress-circle">
          <svg>
            <circle class="bg" cx="30" cy="30" r="26"></circle>
            <circle class="progress" id="proteinProgress" cx="30" cy="30" r="26"></circle>
          </svg>
        </div>
        <div class="value" id="totalProtein">0</div>
        <div class="label">Білки</div>
      </div>
      <div>
        <div class="progress-circle">
          <svg>
            <circle class="bg" cx="30" cy="30" r="26"></circle>
            <circle class="progress" id="caloriesProgress" cx="30" cy="30" r="26"></circle>
          </svg>
        </div>
        <div class="value" id="totalCalories">0</div>
        <div class="label">Калорії</div>
      </div>
    </div>

    <div class="details">
      <div class="settings-section" onclick="editGoals()">
        Редагувати цілі
      </div>
      <div class="section" id="breakfastSection">
        <div class="section-header">
          <h3>
            <img src="https://cdn-icons-png.flaticon.com/512/3595/3595458.png" alt="Breakfast">
            Сніданок
          </h3>
          <div class="calories" id="breakfastCalories">0 Калорій</div>
          <button class="add-btn tooltip" onclick="openFoodSearch('breakfast')">
            <img src="https://cdn-icons-png.flaticon.com/512/992/992651.png" alt="Add">
            Додати їжу
            <span class="tooltiptext">Додати їжу до сніданку</span>
          </button>
        </div>
        <div class="food-list" id="breakfastList"></div>
      </div>
      <div class="section" id="lunchSection">
        <div class="section-header">
          <h3>
            <img src="https://cdn-icons-png.flaticon.com/512/3595/3595462.png" alt="Lunch">
            Обід
          </h3>
          <div class="calories" id="lunchCalories">0 Калорій</div>
          <button class="add-btn tooltip" onclick="openFoodSearch('lunch')">
            <img src="https://cdn-icons-png.flaticon.com/512/992/992651.png" alt="Add">
            Додати їжу
            <span class="tooltiptext">Додати їжу до обіду</span>
          </button>
        </div>
        <div class="food-list" id="lunchList"></div>
      </div>
      <div class="section" id="dinnerSection">
        <div class="section-header">
          <h3>
            <img src="https://cdn-icons-png.flaticon.com/512/3595/3595455.png" alt="Dinner">
            Вечеря
          </h3>
          <div class="calories" id="dinnerCalories">0 Калорій</div>
          <button class="add-btn tooltip" onclick="openFoodSearch('dinner')">
            <img src="https://cdn-icons-png.flaticon.com/512/992/992651.png" alt="Add">
            Додати їжу
            <span class="tooltiptext">Додати їжу до вечері</span>
          </button>
        </div>
        <div class="food-list" id="dinnerList"></div>
      </div>
      <div class="section" id="snackSection">
        <div class="section-header">
          <h3>
            <img src="https://cdn-icons-png.flaticon.com/512/3595/3595460.png" alt="Snack">
            Перекус
          </h3>
          <div class="calories" id="snackCalories">0 Калорій</div>
          <button class="add-btn tooltip" onclick="openFoodSearch('snack')">
            <img src="https://cdn-icons-png.flaticon.com/512/992/992651.png" alt="Add">
            Додати їжу
            <span class="tooltiptext">Додати їжу до перекусу</span>
          </button>
        </div>
        <div class="food-list" id="snackList"></div>
      </div>
      <div class="section" id="waterTrackerSection">
        <div class="section-header">
          <h3>
            <img src="https://cdn-icons-png.flaticon.com/512/3595/3595464.png" alt="Water">
            Трекер Води
          </h3>
          <div class="toggle-btn tooltip" onclick="toggleWaterTracker()">
            ✕
            <span class="tooltiptext">Приховати трекер води</span>
          </div>
        </div>
        <div class="tracker-content" id="waterTracker">
          <input type="number" id="waterAmount" placeholder="мл" value="0">
          <button onclick="addWater()">
            <span>Додати</span>
          </button>
          <div class="total-water" id="totalWater">0 мл</div>
        </div>
      </div>
      <div class="summary-section">
        <div class="summary-text">
          <h3>СВОДКА</h3>
          <div class="calories-label">Залишилось Калорій</div>
          <div class="calories-value" id="remainingCalories">3600</div>
          <div class="calories-label">Спожито Калорій</div>
          <div class="calories-value" id="totalCaloriesSummary">0</div>
          <div class="percentage" id="percentageRsk">0% від РСК</div>
        </div>
        <div class="progress-circle">
          <svg>
            <circle class="bg" cx="50" cy="50" r="45"></circle>
            <circle class="progress" id="summaryProgress" cx="50" cy="50" r="45"></circle>
          </svg>
          <div class="percentage-text" id="summaryPercentage">0%</div>
        </div>
      </div>
    </div>
  </div>

  <div class="food-search" id="foodSearch">
    <div class="modal-header">
      <h3>Пошук їжі</h3>
      <button class="close-btn tooltip" onclick="closeFoodSearch()">
        ✕
        <span class="tooltiptext">Закрити пошук</span>
      </button>
    </div>
    <div class="tabs">
      <div class="active">ЇЖА</div>
      <div>РЕЦЕПТИ</div>
      <div>ПІДБІР КНИГА</div>
    </div>
    <div class="search-bar">
      <input type="text" placeholder="Пошук їжі" id="foodSearchInput" oninput="searchFood(this.value)">
      <img src="https://cdn-icons-png.flaticon.com/512/482/482947.png" alt="Search">
    </div>
    <div class="error-message" id="searchError">Не вдалося завантажити дані. Спробуйте ще раз.</div>
    <div class="results" id="searchResults"></div>
  </div>

  <div class="weight-modal" id="weightModal">
    <h3>Введіть вагу (г)</h3>
    <input type="number" id="foodWeight" placeholder="100" value="100">
    <button onclick="confirmWeight()">Додати</button>
  </div>

  <div class="calendar-modal" id="calendarModal">
    <div class="modal-header">
      <h3>Оберіть дату</h3>
      <button class="close-btn tooltip" onclick="closeCalendar()">
        ✕
        <span class="tooltiptext">Закрити календар</span>
      </button>
    </div>
    <div class="calendar-grid" id="calendarGrid"></div>
  </div>

  <div class="goals-modal" id="goalsModal">
    <div id="goals-particles-js"></div>
    <div class="progress-bar">
      <div class="progress" id="progressBar"></div>
    </div>
    <div class="header">
      <h2>Ваші цілі</h2>
      <button class="close-btn tooltip" onclick="closeGoalsModal()">
        Закрити
        <span class="tooltiptext">Закрити налаштування цілей</span>
      </button>
    </div>
    <div class="step" id="stepDateOfBirth">
      <h3>Ваша дата народження?</h3>
      <input type="number" id="birthDay" placeholder="День (1-31)" min="1" max="31">
      <select id="birthMonth">
        <option value="">Місяць</option>
        <option value="1">Січня</option>
        <option value="2">Лютого</option>
        <option value="3">Березня</option>
        <option value="4">Квітня</option>
        <option value="5">Травня</option>
        <option value="6">Червня</option>
        <option value="7">Липня</option>
        <option value="8">Серпня</option>
        <option value="9">Вересня</option>
        <option value="10">Жовтня</option>
        <option value="11">Листопада</option>
        <option value="12">Грудня</option>
      </select>
      <input type="number" id="birthYear" placeholder="Рік (1900-2025)" min="1900" max="2025">
      <div class="error" id="errorDateOfBirth">Будь ласка, введіть коректну дату народження</div>
      <button class="next-btn" onclick="validateStep('stepDateOfBirth', 'stepHeight')">Далі</button>
    </div>
    <div class="step" id="stepHeight" style="display: none;">
      <h3>Який у вас зріст?</h3>
      <input type="number" id="height" placeholder="Зріст у см">
      <div class="error" id="errorHeight">Будь ласка, введіть зріст (100-250 см)</div>
      <button class="next-btn" onclick="validateStep('stepHeight', 'stepWeight')">Далі</button>
    </div>
    <div class="step" id="stepWeight" style="display: none;">
      <h3>Який ваш теперішній вес?</h3>
      <input type="number" id="weight" placeholder="Вага у кг">
      <div class="error" id="errorWeight">Будь ласка, введіть вагу (30-300 кг)</div>
      <button class="next-btn" onclick="validateStep('stepWeight', 'stepGoal')">Далі</button>
    </div>
    <div class="step" id="stepGoal" style="display: none;">
      <h3>Яка ваша ціль?</h3>
      <div class="options">
        <div class="option" data-value="lose" onclick="selectOption(this, 'goal')">
          <p>СХУДНЕННЯ</p>
          <small>Намагатися скинути вагу шляхом РСК нижче рекомендованого рівня</small>
        </div>
        <div class="option" data-value="maintain" onclick="selectOption(this, 'goal')">
          <p>ЗБЕРЕЖЕННЯ НИНІШНЬОГО ВЕСУ</p>
          <small>Намагатися підтримувати вагу, споживаючи стільки ж калорій, скільки ви спалюєте</small>
        </div>
        <div class="option" data-value="gain" onclick="selectOption(this, 'goal')">
          <p>НАБІР ВАГИ</p>
          <small>Намагатися набрати вагу шляхом РСК вище рекомендованого рівня</small>
        </div>
      </div>
      <div class="error" id="errorGoal">Будь ласка, виберіть ціль</div>
      <button class="next-btn" onclick="validateStep('stepGoal', 'stepActivity')">Далі</button>
    </div>
    <div class="step" id="stepActivity" style="display: none;">
      <h3>Який ваш рівень активності?</h3>
      <div class="options">
        <div class="option" data-value="sedentary" onclick="selectOption(this, 'activity')">
          <p>СИДЯЧИЙ</p>
          <small>Мінімум фізичної діяльності, тренування відсутні, сидяча робота</small>
        </div>
        <div class="option" data-value="light" onclick="selectOption(this, 'activity')">
          <p>МАЛОАКТИВНИЙ</p>
          <small>Невелика активність, тренування 1-3 рази на тиждень, легка робота</small>
        </div>
        <div class="option" data-value="active" onclick="selectOption(this, 'activity')">
          <p>АКТИВНИЙ</p>
          <small>Помірна активність, тренування 3-5 разів на тиждень, фізична робота</small>
        </div>
        <div class="option" data-value="veryActive" onclick="selectOption(this, 'activity')">
          <p>ДУЖЕ АКТИВНИЙ</p>
          <small>Інтенсивна фізична активність, тренування 6-7 разів на тиждень</small>
        </div>
      </div>
      <div class="error" id="errorActivity">Будь ласка, виберіть рівень активності</div>
      <button class="next-btn" onclick="validateStep('stepActivity', 'stepGender')">Далі</button>
    </div>
    <div class="step" id="stepGender" style="display: none;">
      <h3>Ваша стать?</h3>
      <div class="options">
        <div class="option" data-value="female" onclick="selectOption(this, 'gender')">
          <p>ЖІНКА</p>
        </div>
        <div class="option" data-value="male" onclick="selectOption(this, 'gender')">
          <p>ЧОЛОВІК</p>
        </div>
      </div>
      <div class="error" id="errorGender">Будь ласка, виберіть стать</div>
      <button class="next-btn" onclick="validateStep('stepGender', null)">Готово</button>
      <button class="reset-btn" onclick="resetGoals()">Скинути цілі</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
  <script>
    // Налаштування ефектів частинок для фону
    particlesJS('particles-js', {
      particles: {
        number: { value: 80, density: { enable: true, value_area: 800 } },
        color: { value: '#00f0ff' },
        shape: { type: 'circle' },
        opacity: { value: 0.5, random: true },
        size: { value: 3, random: true },
        line_linked: { enable: true, distance: 150, color: '#00f0ff', opacity: 0.4, width: 1 },
        move: { enable: true, speed: 2, direction: 'none', random: false, straight: false, out_mode: 'out', bounce: false }
      },
      interactivity: {
        detect_on: 'canvas',
        events: { onhover: { enable: true, mode: 'repulse' }, onclick: { enable: true, mode: 'push' }, resize: true },
        modes: { repulse: { distance: 100, duration: 0.4 }, push: { particles_nb: 4 } }
      },
      retina_detect: true
    });

    particlesJS('goals-particles-js', {
      particles: {
        number: { value: 80, density: { enable: true, value_area: 800 } },
        color: { value: '#00f0ff' },
        shape: { type: 'circle' },
        opacity: { value: 0.5, random: true },
        size: { value: 3, random: true },
        line_linked: { enable: true, distance: 150, color: '#00f0ff', opacity: 0.4, width: 1 },
        move: { enable: true, speed: 2, direction: 'none', random: false, straight: false, out_mode: 'out', bounce: false }
      },
      interactivity: {
        detect_on: 'canvas',
        events: { onhover: { enable: true, mode: 'repulse' }, onclick: { enable: true, mode: 'push' }, resize: true },
        modes: { repulse: { distance: 100, duration: 0.4 }, push: { particles_nb: 4 } }
      },
      retina_detect: true
    });

    // Локальна база даних як резерв
    const foodDatabase = [
      { name: "Броколі та морквяні млинці", calories: 150, protein: 5, fat: 3, carbs: 25, image: "https://images.unsplash.com/photo-1593079831268-3381b0db4a77" },
      { name: "Карі з солодкої картоплі та нуту", calories: 200, protein: 8, fat: 5, carbs: 30, image: "https://images.unsplash.com/photo-1593079831268-3381b0db4a77" },
      { name: "Курячий салат", calories: 180, protein: 20, fat: 8, carbs: 5, image: "https://images.unsplash.com/photo-1593079831268-3381b0db4a77" },
      { name: "Сирники", calories: 220, protein: 15, fat: 10, carbs: 15, image: "https://images.unsplash.com/photo-1593079831268-3381b0db4a77" },
      { name: "Вівсянка", calories: 120, protein: 5, fat: 2, carbs: 20, image: "https://images.unsplash.com/photo-1593079831268-3381b0db4a77" },
      { name: "Грильована курка", calories: 165, protein: 31, fat: 3.6, carbs: 0, image: "https://images.unsplash.com/photo-1593079831268-3381b0db4a77" }
    ];

    let dailyLog = JSON.parse(localStorage.getItem('dailyLog')) || {};
    let userGoals = JSON.parse(localStorage.getItem('userGoals')) || {};
    let dailyCalorieGoal = userGoals.calorieGoal || 3600;
    let currentMeal = '';
    let selectedFood = null;
    let currentDate = new Date();
    let waterTracker = JSON.parse(localStorage.getItem('waterTracker')) || { total: 0, enabled: true };
    let currentStepIndex = 0;
    const steps = ['stepDateOfBirth', 'stepHeight', 'stepWeight', 'stepGoal', 'stepActivity', 'stepGender'];
    const searchCache = JSON.parse(localStorage.getItem('searchCache')) || {};

    // Запит до FatSecret через серверний проксі
    async function fatSecretRequest(method, params) {
      const response = await fetch(`/fatsecret?q=${encodeURIComponent(params.search_expression)}`, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json'
        }
      });
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      return await response.json();
    }

    async function searchFood(query) {
      const resultsDiv = document.getElementById('searchResults');
      const errorDiv = document.getElementById('searchError');
      resultsDiv.innerHTML = '';
      errorDiv.style.display = 'none';

      // Перевірка кешу
      if (searchCache[query]) {
        displaySearchResults(searchCache[query]);
        return;
      }

      // Пропускаємо запит API, якщо запит занадто короткий
      if (query.length < 3) {
        return;
      }

      try {
        const params = {
          search_expression: query,
          format: 'json',
          max_results: 10
        };

        const data = await fatSecretRequest('foods.search', params);

        if (data.foods && data.foods.food) {
          const foods = data.foods.food.map(food => ({
            food_id: food.food_id,
            name: food.food_name,
            description: food.food_description || ''
          }));

          // Зберігаємо в кеш
          searchCache[query] = foods;
          localStorage.setItem('searchCache', JSON.stringify(searchCache));

          displaySearchResults(foods);
        } else {
          throw new Error('No results found');
        }
      } catch (error) {
        console.error('Search Error:', error);
        errorDiv.textContent = 'Не вдалося завантажити дані з FatSecret. Використовуємо локальну базу.';
        errorDiv.style.display = 'block';

        // Використовуємо локальну базу як резерв
        const fallbackResults = foodDatabase.filter(food => food.name.toLowerCase().includes(query.toLowerCase()));
        displaySearchResults(fallbackResults.map(food => ({
          ...food,
          food_id: null
        })));
      }
    }

    function displaySearchResults(foods) {
      const resultsDiv = document.getElementById('searchResults');
      resultsDiv.innerHTML = '';

      foods.forEach(food => {
        const caloriesMatch = food.description ? food.description.match(/Calories: (\d+)kcal/) : null;
        const calories = caloriesMatch ? parseFloat(caloriesMatch[1]) : food.calories || 0;

        const item = document.createElement('div');
        item.className = 'item';
        item.innerHTML = `
          <img src="${food.image || 'https://images.unsplash.com/photo-1593079831268-3381b0db4a77'}" alt="${food.name}">
          <div class="info">
            <div class="name">${food.name}</div>
            <div class="time">${calories} ккал / 100г</div>
          </div>
        `;
        item.onclick = () => {
          if (food.food_id) {
            fetchFoodDetails(food.food_id);
          } else {
            selectedFood = { ...food };
            document.getElementById('foodSearch').style.display = 'none';
            const weightModal = document.getElementById('weightModal');
            initializeDailyLog();
            weightModal.style.display = 'block';
            setTimeout(() => weightModal.classList.add('active'), 10);
            document.getElementById('foodWeight').value = 100;
          }
        };
        resultsDiv.appendChild(item);
      });
    }

    async function fetchFoodDetails(foodId) {
      try {
        const params = {
          method: 'food.get.v4',
          food_id: foodId,
          format: 'json'
        };

        const data = await fatSecretRequest('food.get.v4', params);

        if (data.food && data.food.servings && data.food.servings.serving) {
          const serving = Array.isArray(data.food.servings.serving)
            ? data.food.servings.serving.find(s => s.serving_description.includes('100 g')) || data.food.servings.serving[0]
            : data.food.servings.serving;

          selectedFood = {
            name: data.food.food_name,
            calories: parseFloat(serving.calories) || 0,
            protein: parseFloat(serving.protein) || 0,
            fat: parseFloat(serving.fat) || 0,
            carbs: parseFloat(serving.carbohydrate) || 0,
            image: '' // FatSecret не надає зображень
          };

          document.getElementById('foodSearch').style.display = 'none';
          const weightModal = document.getElementById('weightModal');
          weightModal.style.display = 'block';
          setTimeout(() => weightModal.classList.add('active'), 10);
          document.getElementById('foodWeight').value = 100;
        } else {
          throw new Error('Food details not found');
        }
      } catch (error) {
        console.error('Fetch Food Details Error:', error);
        const errorDiv = document.getElementById('searchError');
        errorDiv.textContent = 'Не вдалося отримати деталі продукту. Спробуйте ще раз.';
        errorDiv.style.display = 'block';
      }
    }

    function confirmWeight() {
      const weight = parseFloat(document.getElementById('foodWeight').value) || 100;
      const factor = weight / 100;
      const foodToAdd = {
        ...selectedFood,
        weight: weight,
        calories: selectedFood.calories * factor,
        protein: selectedFood.protein * factor,
        fat: selectedFood.fat * factor,
        carbs: selectedFood.carbs * factor
      };

      const dateKey = getDateKey(currentDate);
      dailyLog[dateKey][currentMeal].push(foodToAdd);
      localStorage.setItem('dailyLog', JSON.stringify(dailyLog));

      const weightModal = document.getElementById('weightModal');
      weightModal.classList.remove('active');
      setTimeout(() => {
        weightModal.style.display = 'none';
      }, 300);

      updateUI();
    }

    function deleteFood(meal, index) {
      const dateKey = getDateKey(currentDate);
      dailyLog[dateKey][meal].splice(index, 1);
      localStorage.setItem('dailyLog', JSON.stringify(dailyLog));
      updateUI();
    }

    function updateUI() {
      const dateKey = getDateKey(currentDate);
      const meals = ['breakfast', 'lunch', 'dinner', 'snack'];
      let totalCalories = 0, totalFat = 0, totalCarbs = 0, totalProtein = 0;

      meals.forEach(meal => {
        const list = document.getElementById(`${meal}List`);
        const caloriesDiv = document.getElementById(`${meal}Calories`);
        list.innerHTML = '';

        const mealItems = dailyLog[dateKey][meal] || [];
        let mealCalories = 0;

        mealItems.forEach((item, index) => {
          mealCalories += item.calories;
          totalCalories += item.calories;
          totalFat += item.fat;
          totalCarbs += item.carbs;
          totalProtein += item.protein;

          const foodItem = document.createElement('div');
          foodItem.className = 'food-item';
          foodItem.innerHTML = `
            <div class="name">${item.name} (${item.weight} г)</div>
            <button class="delete-btn" onclick="deleteFood('${meal}', ${index})">Видалити</button>
          `;
          list.appendChild(foodItem);
        });

        caloriesDiv.textContent = `${Math.round(mealCalories)} Калорій`;
      });

      document.getElementById('totalCalories').textContent = Math.round(totalCalories);
      document.getElementById('totalFat').textContent = Math.round(totalFat);
      document.getElementById('totalCarbs').textContent = Math.round(totalCarbs);
      document.getElementById('totalProtein').textContent = Math.round(totalProtein);
      document.getElementById('totalCaloriesSummary').textContent = Math.round(totalCalories);

      const remainingCalories = dailyCalorieGoal - totalCalories;
      document.getElementById('remainingCalories').textContent = Math.round(remainingCalories);

      const percentage = (totalCalories / dailyCalorieGoal) * 100;
      document.getElementById('percentageRsk').textContent = `${Math.round(percentage)}% від РСК`;
      document.getElementById('summaryPercentage').textContent = `${Math.round(percentage)}%`;

      const fatProgress = (totalFat / (userGoals.fatGoal || 100)) * 163;
      const carbsProgress = (totalCarbs / (userGoals.carbsGoal || 100)) * 163;
      const proteinProgress = (totalProtein / (userGoals.proteinGoal || 100)) * 163;
      const caloriesProgress = (totalCalories / dailyCalorieGoal) * 163;
      const summaryProgress = (totalCalories / dailyCalorieGoal) * 283;

      document.getElementById('fatProgress').style.strokeDashoffset = 163 - fatProgress;
      document.getElementById('carbsProgress').style.strokeDashoffset = 163 - carbsProgress;
      document.getElementById('proteinProgress').style.strokeDashoffset = 163 - proteinProgress;
      document.getElementById('caloriesProgress').style.strokeDashoffset = 163 - caloriesProgress;
      document.getElementById('summaryProgress').style.strokeDashoffset = 283 - summaryProgress;

      document.getElementById('totalWater').textContent = `${waterTracker.total} мл`;
      document.getElementById('waterTrackerSection').style.display = waterTracker.enabled ? 'block' : 'none';
    }

    function addWater() {
      const amount = parseFloat(document.getElementById('waterAmount').value) || 0;
      waterTracker.total += amount;
      localStorage.setItem('waterTracker', JSON.stringify(waterTracker));
      updateUI();
    }

    function toggleWaterTracker() {
      waterTracker.enabled = !waterTracker.enabled;
      localStorage.setItem('waterTracker', JSON.stringify(waterTracker));
      updateUI();
    }

    function openFoodSearch(meal) {
      currentMeal = meal;
      const foodSearch = document.getElementById('foodSearch');
      foodSearch.style.display = 'block';
      setTimeout(() => foodSearch.classList.add('active'), 10);
      document.getElementById('foodSearchInput').focus();
    }

    function closeFoodSearch() {
      const foodSearch = document.getElementById('foodSearch');
      foodSearch.classList.remove('active');
      setTimeout(() => {
        foodSearch.style.display = 'none';
        document.getElementById('searchResults').innerHTML = '';
        document.getElementById('searchError').style.display = 'none';
      }, 300);
    }

    function openCalendar() {
      const calendarModal = document.getElementById('calendarModal');
      calendarModal.style.display = 'block';
      setTimeout(() => calendarModal.classList.add('active'), 10);
      generateCalendar();
    }

    function closeCalendar() {
      const calendarModal = document.getElementById('calendarModal');
      calendarModal.classList.remove('active');
      setTimeout(() => {
        calendarModal.style.display = 'none';
      }, 300);
    }

    function generateCalendar() {
      const calendarGrid = document.getElementById('calendarGrid');
      calendarGrid.innerHTML = '';

      const daysOfWeek = ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Нд'];
      daysOfWeek.forEach(day => {
        const dayHeader = document.createElement('div');
        dayHeader.className = 'header';
        dayHeader.textContent = day;
        calendarGrid.appendChild(dayHeader);
      });

      const firstDayOfMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1).getDay();
      const daysInMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0).getDate();
      const offset = firstDayOfMonth === 0 ? 6 : firstDayOfMonth - 1;

      for (let i = 0; i < offset; i++) {
        const emptyDay = document.createElement('div');
        calendarGrid.appendChild(emptyDay);
      }

      for (let day = 1; day <= daysInMonth; day++) {
        const dayDiv = document.createElement('div');
        dayDiv.className = 'day';
        dayDiv.textContent = day;
        dayDiv.onclick = () => {
          currentDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
          updateDateDisplay();
          closeCalendar();
          initializeDailyLog();
          updateUI();
        };
        calendarGrid.appendChild(dayDiv);
      }
    }

    function getDateKey(date) {
      return `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;
    }

    function updateDateDisplay() {
      const today = new Date();
      const dateKey = getDateKey(currentDate);
      const todayKey = getDateKey(today);
      const display = dateKey === todayKey ? 'Сьогодні' : currentDate.toLocaleDateString('uk-UA', { day: 'numeric', month: 'long', year: 'numeric' });
      document.getElementById('currentDate').textContent = display;
    }

    function initializeDailyLog() {
      const dateKey = getDateKey(currentDate);
      if (!dailyLog[dateKey]) {
        dailyLog[dateKey] = {
          breakfast: [],
          lunch: [],
          dinner: [],
          snack: []
        };
        localStorage.setItem('dailyLog', JSON.stringify(dailyLog));
      }
    }

    function showGoalsModal() {
      document.getElementById('goalsModal').style.display = 'block';
      updateProgressBar();
      initializeDailyLog();
    }

    function closeGoalsModal() {
      document.getElementById('goalsModal').style.display = 'none';
      currentStepIndex = 0;
      steps.forEach((step, index) => {
        document.getElementById(step).style.display = index === 0 ? 'block' : 'none';
      });
      updateProgressBar();
    }

    function editGoals() {
      const goalsModal = document.getElementById('goalsModal');
      goalsModal.style.display = 'block';
      currentStepIndex = 0;
      steps.forEach((step, index) => {
        document.getElementById(step).style.display = index === 0 ? 'block' : 'none';
      });
      updateProgressBar();

      document.getElementById('birthDay').value = userGoals.birthDay || '';
      document.getElementById('birthMonth').value = userGoals.birthMonth || '';
      document.getElementById('birthYear').value = userGoals.birthYear || '';
      document.getElementById('height').value = userGoals.height || '';
      document.getElementById('weight').value = userGoals.weight || '';

      if (userGoals.goal) {
        const goalOption = document.querySelector(`#stepGoal .option[data-value="${userGoals.goal}"]`);
        if (goalOption) selectOption(goalOption, 'goal', false);
      }
      if (userGoals.activity) {
        const activityOption = document.querySelector(`#stepActivity .option[data-value="${userGoals.activity}"]`);
        if (activityOption) selectOption(activityOption, 'activity', false);
      }
      if (userGoals.gender) {
        const genderOption = document.querySelector(`#stepGender .option[data-value="${userGoals.gender}"]`);
        if (genderOption) selectOption(genderOption, 'gender', false);
      }
    }

    function resetGoals() {
      userGoals = {};
      localStorage.removeItem('userGoals');
      editGoals();
    }

    function updateProgressBar() {
      const progress = (currentStepIndex / (steps.length - 1)) * 100;
      document.getElementById('progressBar').style.width = `${progress}%`;
    }

    function validateStep(currentStep, nextStep) {
      let valid = true;
      const errorDiv = document.getElementById(`error${currentStep.replace('step', '')}`);
      errorDiv.style.display = 'none';

      if (currentStep === 'stepDateOfBirth') {
        const day = parseInt(document.getElementById('birthDay').value) || 0;
        const month = document.getElementById('birthMonth').value;
        const year = parseInt(document.getElementById('birthYear').value) || 0;
        if (!day || day < 1 || day > 31 || !month || !year || year < 1900 || year > 2025) {
          valid = false;
          errorDiv.textContent = 'Будь ласка, введіть коректну дату народження (день: 1-31, рік: 1900-2025)';
          errorDiv.style.display = 'block';
        } else {
          userGoals.birthDay = day;
          userGoals.birthMonth = month;
          userGoals.birthYear = year;
        }
      } else if (currentStep === 'stepHeight') {
        const height = parseFloat(document.getElementById('height').value) || 0;
        if (!height || height < 100 || height > 250) {
          valid = false;
          errorDiv.textContent = 'Будь ласка, введіть зріст (100-250 см)';
          errorDiv.style.display = 'block';
        } else {
          userGoals.height = height;
        }
      } else if (currentStep === 'stepWeight') {
        const weight = parseFloat(document.getElementById('weight').value) || 0;
        if (!weight || weight < 30 || weight > 300) {
          valid = false;
          errorDiv.textContent = 'Будь ласка, введіть вагу (30-300 кг)';
          errorDiv.style.display = 'block';
        } else {
          userGoals.weight = weight;
        }
      } else if (currentStep === 'stepGoal') {
        if (!userGoals.goal) {
          valid = false;
          errorDiv.textContent = 'Будь ласка, виберіть ціль';
          errorDiv.style.display = 'block';
        }
      } else if (currentStep === 'stepActivity') {
        if (!userGoals.activity) {
          valid = false;
          errorDiv.textContent = 'Будь ласка, виберіть рівень активності';
          errorDiv.style.display = 'block';
        }
      } else if (currentStep === 'stepGender') {
        if (!userGoals.gender) {
          valid = false;
          errorDiv.textContent = 'Будь ласка, виберіть стать';
          errorDiv.style.display = 'block';
        } else {
          saveGoals();
        }
      }

      if (valid && nextStep) {
        currentStepIndex++;
        document.getElementById(currentStep).style.display = 'none';
        document.getElementById(nextStep).style.display = 'block';
        updateProgressBar();
      }
      updateCalorieGoalPreview();
    }

    function selectOption(element, type, update = true) {
      const options = element.parentElement.querySelectorAll('.option');
      options.forEach(opt => opt.classList.remove('selected'));
      element.classList.add('selected');
      userGoals[type] = element.getAttribute('data-value');
      if (update) updateCalorieGoalPreview();
    }

    function calculateCalorieGoal() {
      const requiredFields = ['weight', 'height', 'birthDay', 'birthMonth', 'birthYear', 'gender', 'activity', 'goal'];
      const missingFields = requiredFields.filter(field => !userGoals[field]);

      if (missingFields.length > 0) {
        return 3600; // Значення за замовчуванням, якщо якісь поля відсутні
      }

      const weight = parseFloat(userGoals.weight);
      const height = parseFloat(userGoals.height);
      const birthYear = parseInt(userGoals.birthYear);
      const birthMonth = parseInt(userGoals.birthMonth) - 1;
      const birthDay = parseInt(userGoals.birthDay);
      const gender = userGoals.gender;
      const activity = userGoals.activity;
      const goal = userGoals.goal;

      // Обчислення віку
      const birthDate = new Date(birthYear, birthMonth, birthDay);
      const today = new Date();
      let age = today.getFullYear() - birthDate.getFullYear();
      const monthDiff = today.getMonth() - birthDate.getMonth();
      if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
        age--;
      }

      // Обчислення BMR (Basal Metabolic Rate) за формулою Міффліна-Сан Жеора
      let bmr;
      if (gender === 'male') {
        bmr = 10 * weight + 6.25 * height - 5 * age + 5;
      } else {
        bmr = 10 * weight + 6.25 * height - 5 * age - 161;
      }

      // Множник активності
      const activityFactors = {
        sedentary: 1.2,
        light: 1.375,
        active: 1.55,
        veryActive: 1.725
      };
      const activityFactor = activityFactors[activity] || 1.2;

      // Розрахунок TDEE (Total Daily Energy Expenditure)
      let tdee = bmr * activityFactor;

      // Налаштування залежно від цілі
      const goalAdjustments = {
        lose: 0.8, // 20% дефіцит
        maintain: 1,
        gain: 1.2 // 20% надлишок
      };
      const goalAdjustment = goalAdjustments[goal] || 1;

      const calorieGoal = tdee * goalAdjustment;

      // Розрахунок макронутрієнтів (40% вуглеводи, 30% білки, 30% жири)
      const carbsCalories = calorieGoal * 0.4;
      const proteinCalories = calorieGoal * 0.3;
      const fatCalories = calorieGoal * 0.3;

      userGoals.carbsGoal = carbsCalories / 4; // 4 ккал на грам вуглеводів
      userGoals.proteinGoal = proteinCalories / 4; // 4 ккал на грам білків
      userGoals.fatGoal = fatCalories / 9; // 9 ккал на грам жирів

      return Math.round(calorieGoal);
    }

    function updateCalorieGoalPreview() {
      dailyCalorieGoal = calculateCalorieGoal();
      userGoals.calorieGoal = dailyCalorieGoal;
      localStorage.setItem('userGoals', JSON.stringify(userGoals));
      updateUI();
    }

    function saveGoals() {
      localStorage.setItem('userGoals', JSON.stringify(userGoals));
      closeGoalsModal();
      updateUI();
    }

    // Ініціалізація при завантаженні сторінки
    window.onload = function() {
      if (!Object.keys(userGoals).length) {
        showGoalsModal();
      }
      updateDateDisplay();
      initializeDailyLog();
      updateUI();
    };
  </script>